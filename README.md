![bash-small](https://user-images.githubusercontent.com/13176091/54089754-070c6c00-4375-11e9-8495-d06e9d5f3fe3.png)

## Test Internet Chenge GW

Проверка наличия интернета и переключения шлюзов

***
#### Краткое описание

Программа для проверки наличия интернета на двух шлюзах. Шлюз1 используется по умолчанию, Шлюз2 резервный. Если на Шлюз1 интернет по каким-либо причинам отсутсвует, программа переключает на использование Шлюз2. После чего проверяет доступность интернета на этом шлюзе. Если интернет на Шлюз2 так же не доступен, программа завершается с кодом 1. 

Повторный запуск программы выполняется с помощью `cron` с интервалом 5-10 минут. При повторном запуске программа проверяет какой шлюз используется. Если использовался Шлюз2, происходит возврат к использованию Шлюз1 и происходит проверка интернета. Если интернет вновь стал доступен, программа завершается с кодом 0. Если же интернет на Шлюз1 не доступен происходит возрат к использованию Шлюз2.

#### Настройка для использования программы
* Назначаем сетевому интерфейсу 2 ip адреса

Если используется файл `/etc/network/interfaces`
```bash
auto lo
iface lo inet loopback

auto eth0 
iface eth0 inet static
    address 192.168.1.215
    netmask 255.255.255.0
    gateway 192.168.1.1
    dns-nameservers 8.8.8.8 208.67.222.222 

auto eth0:0
iface eth0:0 inet static
    address 192.168.2.215
    netmask 255.255.255.0
```

или таким образом, если один из адресов назначается DHCP сервером

```bash
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp
dns-nameservers 8.8.8.8 208.67.222.222

auto eth0:0
iface eth0:0 inet static
    address 192.168.2.106
    netmask 255.255.255.0
````

Если же используется `netplan`

```bash
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s18:
      dhcp4: no
      dhcp6: no
      addresses: [192.168.1.3/24,192.168.0.3/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8,208.67.222.222]
```
* Прописываем имена и IP адреса шлюзов в файле `/etc/hosts`

```bash
192.168.1.1	DD-WRT
192.168.2.1	ASUS
```

* Копируем файл программы в каталог `/usr/local/bin`, проверяем является ли он исполняемым
* Создаем задание в `cron` для переодического запуска программы
```bash
crontab -e
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
*/10 * * * * /usr/local/bin/Test_Internet.sh # включение программы каждые 10 минут
```
***


